<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu√°n ƒÇn Ngon - C·ª≠a H√†ng Tr·ª±c Tuy·∫øn</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
    :root {
        --primary-color: #1a1a2e;
        --secondary-color: #ff6b6b;
        --accent-color: #ffd93d;
        --bg-color: #f8f9fa;
        --card-bg: #ffffff;
        --text-color: #1a1a2e;
        --light-text-color: #6c757d;
        --border-radius: 16px;
        --shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --gradient-secondary: linear-gradient(135deg, #ff6b6b 0%, #ff8e72 100%);
        --gradient-accent: linear-gradient(135deg, #ffd93d 0%, #ff9f5a 100%);
    }

    body {
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        color: var(--text-color);
        line-height: 1.6;
        overflow-x: hidden;
    }

    h1, h2, h3, h4 {
        font-family: 'Playfair Display', serif;
        margin-top: 0;
    }
    h1 { 
        font-size: 2.8em; 
        font-weight: 700; 
        color: #fff;
        text-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        letter-spacing: 1px;
    }
    h2 { 
        font-size: 2.2em; 
        border-bottom: 3px solid transparent;
        border-image: var(--gradient-secondary) 1;
        padding-bottom: 15px; 
        margin-bottom: 25px;
        background: linear-gradient(135deg, #ff6b6b 0%, #ff8e72 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .container {
        max-width: 1200px;
        margin: auto;
        padding: 20px;
    }

    header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 20px 40px;
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        backdrop-filter: blur(10px);
    }

    #admin-btn {
        position: absolute;
        left: 18px;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255,255,255,0.1);
        color: #fff;
        border: 2px solid rgba(255,255,255,0.3);
        padding: 10px 16px;
        font-size: 1em;
        font-weight: 600;
        border-radius: 12px;
        cursor: pointer;
        transition: var(--transition);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(10px);
    }

    #admin-btn:hover {
        background: rgba(255,255,255,0.2);
        border-color: rgba(255,255,255,0.5);
        transform: translateY(-50%) scale(1.05);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
    }

    .main-container {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr;
        gap: 25px;
        padding: 0 20px;
        margin-top: 30px;
    }

    @media (max-width: 992px) {
        .main-container {
            grid-template-columns: 1fr;
        }
    }

    .card {
        background: var(--card-bg);
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        transition: var(--transition);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: slideUp 0.6s ease-out;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .card:hover {
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
        transform: translateY(-5px);
    }

    .card.left-sidebar, .card.right-sidebar {
        padding: 20px;
        min-height: 500px;
    }

    .category-filter {
        display: flex;
        justify-content: flex-start;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 20px;
    }

    .category-btn {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--light-text-color);
        border: 2px solid transparent;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        position: relative;
        overflow: hidden;
    }

    .category-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gradient-secondary);
        transition: left 0.3s ease;
        z-index: -1;
    }

    .category-btn:hover::before, .category-btn.active::before {
        left: 0;
    }

    .category-btn.active, .category-btn:hover {
        color: #fff;
        border-color: var(--secondary-color);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }

    #product-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 25px;
    }

    .product {
        border-radius: var(--border-radius);
        padding: 20px 20px 80px;
        text-align: center;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: var(--transition);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .product::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 107, 107, 0.1) 0%, transparent 70%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .product:hover::before {
        opacity: 1;
    }

    .product:hover {
        box-shadow: 0 20px 50px rgba(102, 126, 234, 0.2);
        transform: translateY(-12px);
    }

    .product img {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 15px;
        transition: transform 0.5s cubic-bezier(0.23, 1, 0.320, 1);
        filter: brightness(1);
    }
    .product:hover img {
        transform: scale(1.1) rotateY(5deg);
        filter: brightness(1.1);
    }

    .product h3 {
        margin: 10px 0 5px 0;
        font-size: 1.3em;
        color: var(--text-color);
        font-weight: 600;
    }

    .product p {
        color: var(--secondary-color);
        font-weight: 700;
        font-size: 1.3em;
        margin: 0 0 15px 0;
    }

    .product button {
        position: absolute;
        bottom: 16px;
        left: 50%;
        transform: translateX(-50%);
        width: calc(100% - 40px);
        max-width: 220px;
        background: var(--gradient-secondary);
        color: #fff;
        border: none;
        padding: 12px 10px;
        border-radius: 28px;
        cursor: pointer;
        font-size: 1em;
        font-weight: 700;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }

    .product button:hover {
        transform: translateX(-50%) scale(1.05);
        box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
    }

    .product button:active {
        transform: translateX(-50%) scale(0.98);
    }

    #toast-notification {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--gradient-secondary);
        color: #fff;
        padding: 15px 30px;
        border-radius: 50px;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out, transform 0.4s ease-in-out;
        z-index: 1000;
        box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        font-weight: 600;
        backdrop-filter: blur(10px);
    }

    #toast-notification.show {
        opacity: 1;
        visibility: visible;
        transform: translateX(-50%) translateY(-15px);
        animation: slideDown 0.4s ease-out;
    }

    @keyframes slideDown {
        from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
        }
        to {
            transform: translateX(-50%) translateY(-15px);
            opacity: 1;
        }
    }

    .main-action-btn {
        width: 100%;
        margin-top: 20px;
        padding: 15px;
        font-size: 1.1em;
        font-weight: bold;
        border-radius: 12px;
        transition: var(--transition);
        border: none;
        cursor: pointer;
    }

    #order-btn {
        background: var(--gradient-secondary);
        color: #fff;
        box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
    }

    #order-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(255, 107, 107, 0.4);
    }

    #order-btn:active {
        transform: translateY(-1px);
    }

    #check-order-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    #check-order-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }

    .cart-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        animation: slideInLeft 0.4s ease-out;
    }

    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    .cart-item:last-child {
        border-bottom: none;
    }

    .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 10px;
        margin-right: 15px;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.15);
        transition: var(--transition);
    }

    .cart-item:hover img {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.25);
    }

    .cart-item-info {
        flex-grow: 1;
    }

    .cart-item-info h4 {
        margin: 0;
        font-size: 1.2em;
        font-weight: 600;
        color: var(--text-color);
    }

    .cart-item-info p {
        margin: 5px 0 0;
        color: var(--secondary-color);
        font-weight: bold;
        font-size: 1.1em;
    }

    .quantity-control {
        display: flex;
        align-items: center;
        background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
        border-radius: 20px;
        padding: 5px;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .quantity-control button {
        background: transparent;
        color: var(--secondary-color);
        border: none;
        padding: 5px 10px;
        border-radius: 50%;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.1em;
        transition: var(--transition);
    }

    .quantity-control button:hover {
        background: rgba(255, 107, 107, 0.15);
        transform: scale(1.15);
    }

    .quantity-control span {
        margin: 0 10px;
        font-weight: bold;
        color: var(--text-color);
        min-width: 20px;
        text-align: center;
    }

    #check-order-result {
        margin-top: 20px;
        padding: 18px;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border: 2px solid rgba(102, 126, 234, 0.3);
        border-radius: var(--border-radius);
        color: #667eea;
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.1);
        animation: slideUp 0.5s ease-out;
    }

    #check-order-result ul {
        text-align: left;
        padding-left: 20px;
        margin: 10px 0 0;
    }

    .modal, .admin-page, .pre-order-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, backdrop-filter 0.3s ease-in-out;
        backdrop-filter: blur(0px);
    }
    .modal.show, .admin-page.show, .pre-order-modal.show {
        opacity: 1;
        backdrop-filter: blur(5px);
    }

    .modal-content {
        max-height: 85vh;
        overflow-y: auto;
        background: var(--card-bg);
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        min-width: 450px;
        text-align: center;
        position: relative;
        transform: scale(0.95);
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        opacity: 0;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .modal.show .modal-content {
        transform: scale(1);
        opacity: 1;
    }

    .admin-page-content {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        min-width: 90%;
        max-width: 1400px;
        height: 90vh;
        display: flex;
        flex-direction: column;
        padding: 30px;
        position: relative;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .pre-order-modal-content {
        background: var(--card-bg);
        padding: 30px;
        border-radius: var(--border-radius);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        width: 80%;
        max-width: 700px;
        text-align: center;
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .pre-order-modal-content .product {
        cursor: default;
    }

    .pre-order-modal-content .product:hover {
        transform: none;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .pre-order-modal-content .product button {
        background: var(--secondary-color);
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 600;
        transition: background 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .pre-order-modal-content .product button:hover {
        background: #3a5c3e;
    }

    #pre-order-product-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        max-height: 400px;
        overflow-y: auto;
        padding-right: 15px;
    }

    #pre-order-cart-items {
        max-height: 200px;
        overflow-y: auto;
        padding-right: 15px;
        margin-top: 20px;
    }

    .pre-order-card h4 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 0;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
    }

    .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        padding-bottom: 10px;
    }

    .admin-header h2 {
        border-bottom: none;
        margin-bottom: 0;
        background: var(--gradient-secondary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .admin-header-actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    #clear-completed-orders-btn {
        padding: 10px 18px;
        font-size: 0.9em;
        border-radius: 10px;
        border: none;
        color: #fff;
        cursor: pointer;
        transition: var(--transition);
        background: var(--gradient-secondary);
        display: flex; 
        align-items: center; 
        gap: 5px;
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
    }
    #clear-completed-orders-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
    }

    #admin-search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
    }
    #admin-search-input {
        flex-grow: 1;
        padding: 12px;
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 10px;
        font-size: 1em;
        transition: var(--transition);
    }
    #admin-search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    #admin-search-btn, #admin-search-clear-btn {
        padding: 10px 18px;
        border: none;
        border-radius: 10px;
        color: #fff;
        cursor: pointer;
        font-weight: bold;
        transition: var(--transition);
        display: flex; 
        align-items: center; 
        gap: 5px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    #admin-search-btn { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    #admin-search-btn:hover { 
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    #admin-search-clear-btn { 
        background: var(--gradient-secondary);
        display: none; 
    }
    #admin-search-clear-btn:hover { 
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }

    #admin-dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
        text-align: center;
    }
    .dashboard-item {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
        border: 2px solid rgba(102, 126, 234, 0.1);
    }
    .dashboard-item:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        border-color: rgba(102, 126, 234, 0.3);
    }
    .dashboard-item h4 { 
        margin: 0; 
        font-size: 1.1em; 
        color: #777; 
        font-weight: 600;
    }
    .dashboard-item p { 
        margin: 10px 0 0; 
        font-size: 2.5em; 
        font-weight: bold; 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .dashboard-item.total p { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .dashboard-item.paid p { 
        background: linear-gradient(135deg, #51c0f7 0%, #667eea 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .dashboard-item.pending p { 
        background: var(--gradient-accent);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .dashboard-item.completed p { 
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    .dashboard-item.bank p { 
        background: linear-gradient(135deg, #ff6b6b 0%, #ff8e72 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    #admin-filter-buttons { 
        display: flex; 
        justify-content: center; 
        gap: 10px; 
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    .filter-btn {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: #2C3E50;
        border: 2px solid transparent;
        padding: 10px 20px;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
    }
    .filter-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gradient-secondary);
        transition: left 0.3s ease;
        z-index: -1;
    }
    .filter-btn:hover::before, .filter-btn.active::before {
        left: 0;
    }
    .filter-btn:hover, .filter-btn.active {
        color: #fff;
        border-color: var(--secondary-color);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
        transform: translateY(-2px);
    }

    #orders-list-admin-filtered { 
        flex-grow: 1; 
        overflow-y: auto; 
        padding-right: 15px; 
    }

    .admin-order-item {
        display: grid;
        grid-template-columns: 1fr 240px;
        gap: 18px;
        align-items: start;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        padding: 16px;
        border-radius: 12px;
        margin-bottom: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        transition: var(--transition);
        border: 1px solid rgba(102, 126, 234, 0.1);
        animation: slideInLeft 0.4s ease-out;
    }

    .admin-order-item:hover { 
        transform: translateX(5px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        border-color: rgba(102, 126, 234, 0.3);
    }

    .admin-order-item .order-info {
        padding-right: 6px;
    }

    .admin-order-item .order-info ul {
        margin: 8px 0 0;
        padding-left: 18px;
        max-height: 240px;
        overflow-y: auto;
    }

    .admin-order-item .order-actions {
        justify-self: end;
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
        width: 100%;
    }
    .admin-order-item .order-actions button {
        font-size: 0.92rem;
        padding: 8px 10px;
        border-radius: 8px;
        border: none;
        color: #fff;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .admin-order-item .order-info p, .admin-order-item .order-info h4 {
        word-break: break-word;
    }

    .order-info p { margin: 5px 0; }
    .order-info h4 { font-size: 1.2em; color: #333; margin-bottom: 10px; }

    .order-actions { margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end; }
    
    .order-actions .btn-da-thanh-toan { 
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
    }
    .order-actions .btn-da-thanh-toan:hover { 
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(46, 204, 113, 0.3);
    }
    
    .order-actions .btn-da-lay-hang { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .order-actions .btn-da-lay-hang:hover { 
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
    }
    
    .order-actions .btn-xoa-don { 
        background: var(--gradient-secondary);
    }
    .order-actions .btn-xoa-don:hover { 
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 107, 107, 0.3);
    }

    .status-tag { 
        display: inline-block; 
        padding: 6px 14px; 
        border-radius: 20px; 
        font-weight: bold; 
        font-size: 0.9em;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .status-pending { 
        background: linear-gradient(135deg, #ffd93d 0%, #ff9f5a 100%);
        color: #fff;
    }
    .status-paid { 
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
    }
    .status-completed { 
        background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        color: #fff;
    }

    .modal-close-btn { 
        position: absolute; 
        top: 10px; 
        right: 15px; 
        background: none; 
        border: none; 
        font-size: 1.8em; 
        color: #999; 
        cursor: pointer; 
        transition: color 0.3s;
    }
    .modal-close-btn:hover { 
        color: var(--secondary-color);
        transform: rotate(90deg);
    }

    .pre-order-card { 
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        padding: 20px; 
        border-radius: 10px; 
        box-shadow: inset 0 0 10px rgba(0,0,0,0.02);
        margin-bottom: 15px;
        border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .pre-order-footer { 
        display: flex; 
        justify-content: flex-end; 
        align-items: center; 
        margin-top: 15px; 
    }
    #pre-order-total { 
        font-weight: bold; 
        font-size: 1.3em; 
        margin-right: 15px; 
        background: var(--gradient-secondary);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    #submit-pre-order-btn { 
        padding: 15px 25px; 
        font-size: 1.1em; 
        font-weight: bold; 
        background: var(--gradient-secondary);
        color: #fff; 
        border: none; 
        border-radius: 10px; 
        cursor: pointer; 
        transition: var(--transition);
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }
    #submit-pre-order-btn:hover { 
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
    }

    #loading-spinner { 
        display: none; 
        position: fixed; 
        z-index: 9999; 
        left: 0; 
        top: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(255, 255, 255, 0.8); 
        justify-content: center; 
        align-items: center;
        backdrop-filter: blur(5px);
    }
    .spinner { 
        border: 8px solid #f3f3f3; 
        border-top: 8px solid var(--secondary-color); 
        border-radius: 50%; 
        width: 60px; 
        height: 60px; 
        animation: spin 0.8s linear infinite;
        box-shadow: 0 0 20px rgba(255, 107, 107, 0.3);
    }
    @keyframes spin { 
        0% { transform: rotate(0deg); } 
        100% { transform: rotate(360deg); } 
    }

    .sticky-cart-btn {
        position: fixed;
        bottom: 20px;
        left: 20px;
        right: auto;
        z-index: 500;
        background: var(--gradient-secondary);
        color: white;
        padding: 18px;
        border-radius: 50%;
        box-shadow: 0 10px 30px rgba(255, 107, 107, 0.4);
        cursor: pointer;
        transition: var(--transition);
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .sticky-cart-btn:hover { 
        transform: scale(1.1);
        box-shadow: 0 15px 40px rgba(255, 107, 107, 0.5);
    }

    .sticky-cart-btn:active {
        transform: scale(0.98);
    }

    .sticky-cart-btn.pulse-animation { animation: pulse 0.5s; }
    @keyframes pulse { 
        0% { transform: scale(1); } 
        50% { transform: scale(1.15); } 
        100% { transform: scale(1); } 
    }

    #cart-modal .modal-content { min-width: 500px; max-width: 600px; }
    #payment-modal .modal-content { min-width: 500px; max-width: 550px; }

    #payment-methods { 
        display: flex; 
        gap: 15px; 
        justify-content: center; 
        margin: 20px 0; 
        flex-wrap: wrap; 
    }
    #payment-methods button { 
        padding: 12px 25px; 
        font-size: 1em; 
        border-radius: 10px; 
        cursor: pointer; 
        border: 2px solid rgba(102, 126, 234, 0.2);
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        transition: var(--transition);
        font-weight: 600;
        position: relative;
        overflow: hidden;
    }
    #payment-methods button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gradient-primary);
        transition: left 0.3s ease;
        z-index: -1;
    }
    #payment-methods button:hover::before, #payment-methods button.active::before {
        left: 0;
    }
    #payment-methods button:hover { 
        border-color: #667eea;
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }
    #payment-methods button.active { 
        border-color: #667eea;
        color: #fff;
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    #qr-code-container, #bank-info-container { 
        margin-top: 20px; 
        padding: 20px; 
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        border-radius: var(--border-radius);
        display: none;
        border: 2px solid rgba(102, 126, 234, 0.2);
        animation: slideUp 0.4s ease-out;
    }
    #bank-info-container { text-align: left; }
    #bank-info-container p { margin: 5px 0; }
    #bank-info-container p b { color: var(--secondary-color); }

    #qr-code-container img { 
        max-width: 200px; 
        height: auto; 
        display: block; 
        margin: 0 auto 15px; 
        border: 2px solid rgba(102, 126, 234, 0.2);
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    #qr-note, #bank-note { 
        background: linear-gradient(135deg, #ffd93d 0%, #ff9f5a 100%);
        border: none;
        color: #fff;
        padding: 15px; 
        border-radius: 8px; 
        font-weight: bold;
        box-shadow: 0 5px 15px rgba(255, 107, 107, 0.2);
    }

    #payment-actions { 
        display: flex; 
        justify-content: flex-end; 
        gap: 10px; 
        margin-top: 30px; 
    }
    #payment-actions button { 
        padding: 12px 25px; 
        font-size: 1em; 
        font-weight: bold; 
        border-radius: 10px; 
        border: none; 
        cursor: pointer; 
        transition: var(--transition);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    #confirm-order-btn { 
        background: var(--gradient-secondary);
        color: white;
        box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
    }
    #confirm-order-btn:hover { 
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(255, 107, 107, 0.4);
    }
    #cancel-order-btn { 
        background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        color: white;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    #cancel-order-btn:hover { 
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
    }
    @media (max-width: 768px) {
        body { font-size: 14px; }

        header { flex-direction: column; padding: 15px 20px; text-align: center; gap: 10px; }
        h1 { font-size: 2em; } 
        h2 { font-size: 1.8em; }

        .main-container { grid-template-columns: 1fr; padding: 0 10px; margin-top: 15px; gap: 15px; }
        .card { padding: 20px; }

        .category-filter { justify-content: center; }
        #product-list { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }

        .product h3 { font-size: 1.1em; } 
        .product p { font-size: 1.1em; }
        .product button { padding: 8px 15px; font-size: 0.9em; width: calc(100% - 30px); max-width: none; bottom: 10px; }

        .cart-item img { width: 60px; height: 60px; margin-right: 10px; }
        .cart-item-info h4 { font-size: 1em; } 
        .cart-item-info p { font-size: 1em; }

        .quantity-control button { padding: 3px 8px; }

        .modal-content { min-width: 95%; padding: 20px; box-sizing: border-box; }
        #payment-methods { flex-direction: column; }
        #payment-methods button { padding: 10px; }

        .admin-page-content { padding: 10px; }
        .admin-header { flex-direction: column; align-items: flex-start; gap: 10px; }
        .admin-header h2 { font-size: 1.5em; }
        .admin-header-actions { flex-wrap: wrap; width: 100%; }
        #admin-search-box { flex-direction: column; }
        #admin-search-btn, #admin-search-clear-btn { width: 100%; }
        #admin-dashboard { grid-template-columns: 1fr; }

        #admin-filter-buttons { flex-wrap: wrap; }
        .admin-order-item { padding: 15px; }

        #admin-btn { left: 12px; top: 12px; transform: none; position: absolute; }
        .sticky-cart-btn { left: 14px; bottom: 16px; }
    }

    .main-container .main-content { grid-column: 2; }
    .main-container .sidebar { grid-column: 1 / span 1; }
    .main-container .cart-sidebar { grid-column: 3 / span 1; }

    @media (max-width: 992px) { 
        .main-container { grid-template-columns: 1fr; } 
        .admin-order-item { display: block; padding: 12px; }
        .admin-page .admin-page-content { max-width: 100%; padding: 12px; }
        .admin-dashboard .dashboard-item p { font-size: 1.6rem; }
        #orders-list-admin-filtered { max-height: 56vh; }
    }

    .admin-page .admin-page-content {
        max-width: 1400px;
        width: 95%;
        padding: 18px;
        box-sizing: border-box;
    }

    .admin-header {
        margin-bottom: 12px;
        padding-bottom: 6px;
    }
    .admin-header h2 {
        font-size: 1.45rem;
        margin: 0;
    }
    .admin-dashboard { gap: 12px; margin-bottom: 12px; }
    .admin-dashboard .dashboard-item {
        padding: 14px;
        font-size: 0.95rem;
        min-height: 60px;
    }
    .admin-dashboard .dashboard-item p { font-size: 1.9rem; margin-top: 6px; }

    #admin-search-box { gap: 8px; margin-bottom: 12px; align-items: center; }
    #admin-search-box input#admin-search-input { padding: 8px; font-size: 0.95rem; border-radius: 6px; }
    #admin-search-btn, #admin-search-clear-btn { padding: 8px 12px; font-size: 0.95rem; border-radius: 8px; }

    #admin-filter-buttons .filter-btn {
        padding: 8px 14px;
        font-size: 0.95rem;
        border-radius: 18px;
    }

    #orders-list-admin-filtered {
        flex-grow: 1;
        max-height: 68vh;
        overflow-y: auto;
        padding-right: 12px;
    }

    .admin-order-item {
        display: grid;
        grid-template-columns: 1fr 240px;
        gap: 18px;
        align-items: start;
        padding: 16px;
        border-radius: 12px;
    }

    .admin-order-item .order-info {
        padding-right: 6px;
    }

    .admin-order-item .order-info ul {
        margin: 8px 0 0;
        padding-left: 18px;
        max-height: 240px;
        overflow-y: auto;
    }

    .admin-order-item .order-actions {
        justify-self: end;
        display: flex;
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
        width: 100%;
    }
    .admin-order-item .order-actions button {
        font-size: 0.92rem;
        padding: 8px 10px;
        border-radius: 8px;
    }

    .admin-order-item .order-info p, .admin-order-item .order-info h4 {
        word-break: break-word;
    }

    #admin-modal .modal-content { min-width: 340px; max-width: 520px; }
    #payment-modal .modal-content { min-width: 340px; max-width: 620px; padding: 18px; }
    #cart-modal .modal-content { min-width: 360px; max-width: 620px; }
    .pre-order-modal-content { width: 92%; max-width: 700px; padding: 16px; }

    .modal-content input, .modal-content button, .pre-order-modal-content input, .pre-order-modal-content button {
        padding: 8px 10px;
        font-size: 0.95rem;
    }

    input[type="text"], input[type="password"], input[type="tel"], input[type="email"], textarea {
        border: 2px solid rgba(102, 126, 234, 0.2) !important;
        border-radius: 8px !important;
        padding: 12px !important;
        transition: var(--transition) !important;
        font-family: 'Poppins', sans-serif !important;
    }

    input[type="text"]:focus, input[type="password"]:focus, input[type="tel"]:focus, input[type="email"]:focus, textarea:focus {
        outline: none !important;
        border-color: #667eea !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
    }

    textarea {
        resize: vertical !important;
        min-height: 60px !important;
    }

    .pre-order-modal-content .product {
        cursor: default;
    }

    .pre-order-modal-content .product:hover {
        transform: none;
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.15);
    }

    .pre-order-modal-content .product button {
        background: var(--gradient-secondary);
        color: #fff;
        border: none;
        padding: 10px 15px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9em;
        font-weight: 600;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
    }

    .pre-order-modal-content .product button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 107, 107, 0.3);
    }

    #pre-order-product-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        max-height: 400px;
        overflow-y: auto;
        padding-right: 15px;
    }

    #pre-order-cart-items {
        max-height: 200px;
        overflow-y: auto;
        padding-right: 15px;
        margin-top: 20px;
    }

    .pre-order-card h4 {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 0;
        border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        padding-bottom: 10px;
        color: var(--text-color);
    }

    #customer-info-section {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%) !important;
        border-left: 4px solid var(--secondary-color) !important;
        border-radius: 8px !important;
    }

    #customer-info-section h3 {
        color: var(--secondary-color) !important;
    }

    .toggle-detail-btn {
        padding: 8px 15px;
        font-size: 0.9em;
        border-radius: 8px;
        border: none;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .toggle-detail-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
    }

    .overlay {
        display: block;
    }








    .desktop-hidden {
        display: none !important;
    }

    body.mobile-mode .mobile-hidden {
        display: none !important;
    }

    body.mobile-mode .sidebar {
        grid-column: 1 / span 1 !important;
        order: -1;
    }

    body.mobile-mode .main-content {
        grid-column: 1 / span 1 !important;
        order: 0;
    }

    body.mobile-mode .cart-sidebar {
        display: none !important;
    }

    body.mobile-mode .main-container {
        grid-template-columns: 1fr !important;
    }

    body.mobile-mode .card.sidebar h2 {
        font-size: 1.3em !important;
    }

    body.mobile-mode header {
        padding: 12px 15px !important;
    }

    body.mobile-mode h1 {
        font-size: 1.5em !important;
    }

    body.mobile-mode .sticky-cart-btn {
        bottom: 15px !important;
        left: 15px !important;
        padding: 16px !important;
    }

    body.mobile-mode .sticky-cart-btn i {
        font-size: 1.3em !important;
    }

    body.mobile-mode #product-list {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)) !important;
        gap: 15px !important;
    }

    body.mobile-mode .product {
        padding: 15px 15px 70px !important;
    }

    body.mobile-mode .product button {
        bottom: 12px !important;
        padding: 10px 8px !important;
        font-size: 0.85em !important;
        width: calc(100% - 30px) !important;
    }

    body.mobile-mode .product h3 {
        font-size: 1em !important;
        margin: 8px 0 3px 0 !important;
    }

    body.mobile-mode .product p {
        font-size: 1em !important;
        margin: 0 0 10px 0 !important;
    }

    body.mobile-mode .category-btn {
        padding: 8px 16px !important;
        font-size: 0.9em !important;
    }

    body.mobile-mode .modal-content {
        min-width: 95% !important;
        max-width: 95% !important;
    }

    body.mobile-mode #admin-btn {
        left: 10px !important;
        padding: 8px 12px !important;
        font-size: 0.85em !important;
    }

    body.mobile-mode .cart-total {
        font-size: 1.2em !important;
    }

    body.mobile-mode #order-btn {
        padding: 12px !important;
        font-size: 0.95em !important;
    }

    body.mobile-mode .payment-methods {
        flex-direction: column !important;
    }

    body.mobile-mode .payment-methods button {
        width: 100% !important;
    }

    body.mobile-mode #admin-btn {
        display: none !important;
    }

    body.mobile-mode .modal-content {
        padding: 20px !important;
    }

    body.mobile-mode #payment-modal .modal-content {
        min-width: 90% !important;
        max-width: 95% !important;
    }

    body.mobile-mode #change-device-btn {
        display: flex !important;
    }

    #device-selection-modal {
        display: flex;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(5px);
    }

    #device-selection-modal.show .device-selection-content {
        transform: scale(1);
        opacity: 1;
    }

    .device-selection-content {
        background: var(--card-bg);
        border-radius: var(--border-radius);
        padding: 40px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 500px;
        transform: scale(0.95);
        opacity: 0;
        transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .device-selection-content h2 {
        border: none;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 30px;
        font-size: 1.8em;
    }

    .device-selection-content p {
        color: var(--light-text-color);
        margin-bottom: 30px;
        font-size: 1.05em;
    }

    .device-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .device-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        padding: 25px 35px;
        border: 2px solid rgba(102, 126, 234, 0.2);
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border-radius: 15px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        font-size: 1.1em;
        color: var(--text-color);
        position: relative;
        overflow: hidden;
    }

    .device-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: var(--gradient-primary);
        transition: left 0.3s ease;
        z-index: -1;
    }

    .device-btn:hover::before {
        left: 0;
    }

    .device-btn:hover {
        color: #fff;
        border-color: #667eea;
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(102, 126, 234, 0.3);
    }

    .device-btn i {
        font-size: 2.5em;
        color: #667eea;
    }

    .device-btn:hover i {
        color: #fff;
    }

        body.mobile-mode .product button {
            width: calc(100% - 20px) !important;
        }

        body.mobile-mode #product-list {
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)) !important;
            gap: 10px !important;
        }

        body.mobile-mode .product {
            padding: 10px 10px 65px !important;
        }

        body.mobile-mode .product img {
            height: 100px !important;
        }

        body.mobile-mode h1 {
            font-size: 1.3em !important;
        }
    }

</style>

    
</head>
<body>
    <div id="loading-spinner"><div class="spinner"></div></div>
    
    <div id="toast-notification">ƒê√£ th√™m v√†o gi·ªè h√†ng!</div>

    <div id="device-selection-modal">
        <div class="device-selection-content">
            <h2><i class="fas fa-mobile-alt"></i> Ch·ªçn Thi·∫øt B·ªã</h2>
            <p>B·∫°n ƒëang d√πng ƒëi·ªán tho·∫°i hay m√°y t√≠nh?</p>
            <div class="device-buttons">
                <button class="device-btn" onclick="selectDevice('mobile')">
                    <i class="fas fa-mobile-alt"></i>
                    <span>üì± ƒêi·ªán Tho·∫°i</span>
                </button>
                <button class="device-btn" onclick="selectDevice('desktop')">
                    <i class="fas fa-desktop"></i>
                    <span>üíª M√°y T√≠nh</span>
                </button>
            </div>
        </div>
    </div>

    <div class="overlay">
        <header>
            <h1>Qu√°n ƒÇn Ngon üòã</h1>
            <button id="admin-btn"><i class="fas fa-user-shield"></i> Qu·∫£n Tr·ªã Vi√™n</button>
        </header>

        <div class="container main-container">
            <section class="card sidebar">
                <h2><i class="fas fa-utensils"></i> Danh M·ª•c M√≥n ƒÇn</h2>
                <div class="category-filter" style="flex-direction: column; align-items: flex-start;">
                    <button class="category-btn active" data-category="all" onclick="filterProducts('all', this)">T·∫•t c·∫£</button>
                    <button class="category-btn" data-category="main" onclick="filterProducts('main', this)">M√≥n Ch√≠nh</button>
                    <button class="category-btn" data-category="snack" onclick="filterProducts('snack', this)">M√≥n ƒÇn Nh·∫π</button>
                    <button class="category-btn" data-category="drink" onclick="filterProducts('drink', this)">ƒê·ªì U·ªëng</button>
                </div>
            </section>

            <section class="card main-content">
                <h2><i class="fas fa-fire-alt"></i> Th·ª±c ƒê∆°n H√¥m Nay</h2>
                <div id="product-list-container">
                    <div id="product-list"></div>
                </div>
            </section>

            <section class="card cart-sidebar mobile-hidden">
                <h2><i class="fas fa-receipt"></i> Ki·ªÉm Tra ƒê∆°n H√†ng</h2>
                <div id="check-order-box">
                    <input type="text" id="order-check-input" placeholder="Nh·∫≠p m√£ ƒë∆°n h√†ng..." style="width: 100%; padding: 12px; box-sizing: border-box; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px;" />
                    <button id="check-order-btn" class="main-action-btn" style="margin-top: 0;"><i class="fas fa-search"></i> Ki·ªÉm Tra</button>
                    <div id="check-order-result"></div>
                </div>
            </section>
        </div>
        
        <div class="sticky-cart-btn" onclick="openCartModal()">
            <i class="fas fa-shopping-cart" style="font-size: 1.5em;"></i>
        </div>
    </div>
    
    <div id="cart-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeCartModal()">&times;</button>
            <section id="cart">
                <h2><i class="fas fa-shopping-basket"></i> Gi·ªè H√†ng C·ªßa B·∫°n</h2>
                <div id="cart-items">Gi·ªè h√†ng tr·ªëng.</div>
                <div id="cart-total" style="font-size: 1.5em; font-weight: bold; text-align: right; margin-top: 20px; color: var(--secondary-color);">T·ªïng ti·ªÅn: 0 VNƒê</div>
                <button id="order-btn" class="main-action-btn"><i class="fas fa-cash-register"></i> ƒê·∫∑t H√†ng Ngay</button>
            </section>
        </div>
    </div>

    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closePaymentModal()">&times;</button>
            <h2><i class="fas fa-credit-card"></i> X√°c nh·∫≠n v√† Thanh to√°n</h2>
            <p>M√£ ƒë∆°n h√†ng c·ªßa b·∫°n l√†: <b id="payment-order-code" style="color: var(--primary-color); font-size: 1.2em;"></b></p>
            <div id="customer-info-section" style="margin-bottom: 20px; text-align: left; background: #f0f7ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary-color);">
    <h3 style="text-align: center; margin-top: 0; margin-bottom: 15px; color: var(--secondary-color);">
        <i class="fas fa-user-circle"></i> Th√¥ng Tin Kh√°ch H√†ng
    </h3>
    <div style="display: grid; gap: 12px;">
        <div>
            <label for="customer-name" style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color);">T√™n c·ªßa b·∫°n:</label>
            <input type="text" id="customer-name" placeholder="Nh·∫≠p t√™n..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; font-size: 0.95em;" />
        </div>
        <div>
            <label for="customer-id" style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color);">M√£ h·ªçc sinh / Sinh vi√™n:</label>
            <input type="text" id="customer-id" placeholder="V√≠ d·ª•: HS123456 ho·∫∑c SV2024001..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; font-size: 0.95em;" />
        </div>
        <div>
            <label for="customer-phone" style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color);">S·ªë ƒëi·ªán tho·∫°i:</label>
            <input type="tel" id="customer-phone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; font-size: 0.95em;" />
        </div>
        <div>
            <label for="customer-notes" style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-color);">Ghi ch√∫:</label>
            <textarea id="customer-notes" placeholder="Ghi ch√∫ th√™m (kh√¥ng b·∫Øt bu·ªôc)..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; box-sizing: border-box; resize: vertical; min-height: 60px; font-size: 0.95em; font-family: 'Poppins', sans-serif;"></textarea>
        </div>
    </div>
</div>
            <div id="payment-methods">
                <button id="pay-direct-btn" onclick="selectPaymentMethod('direct', this)"><i class="fas fa-money-bill-alt"></i> Thanh to√°n tr·ª±c ti·∫øp</button>
                <button id="pay-bank-btn" onclick="selectPaymentMethod('bank', this)"><i class="fas fa-university"></i> Thanh to√°n b·∫±ng Ng√¢n h√†ng</button>
                <button id="pay-qr-btn" onclick="selectPaymentMethod('qr', this)"><i class="fas fa-qrcode"></i> Thanh to√°n b·∫±ng m√£ QR</button>
            </div>
            
            <div id="bank-info-container">
                <p><b>Ng√¢n h√†ng:</b> MB Bank (Ng√¢n h√†ng Qu√¢n ƒë·ªôi)</p>
                <p><b>S·ªë t√†i kho·∫£n:</b> 123456789</p>
                <p><b>T√™n ch·ªß t√†i kho·∫£n:</b> TRAN VAN THANH</p>
                <p id="bank-note">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <b>L∆ØU √ù QUAN TR·ªåNG:</b> Khi chuy·ªÉn kho·∫£n, b·∫°n nh·ªõ nh·∫≠p ƒë√∫ng <b>M√£ ƒë∆°n h√†ng</b> ·ªü tr√™n v√†o ph·∫ßn "N·ªôi dung/Ghi ch√∫" ƒë·ªÉ ch√∫ng t√¥i x√°c nh·∫≠n!
                </p>
            </div>

            <div id="qr-code-container">
                <p>Vui l√≤ng qu√©t m√£ QR d∆∞·ªõi ƒë√¢y ƒë·ªÉ thanh to√°n.</p>
                <img src="https://api.vietqr.io/image/970422-19038753239011-p8k2k.jpg?accountName=TRAN%20VAN%20THANH&amount=0" alt="M√£ QR thanh to√°n">
                <p id="qr-note">
                    <i class="fas fa-exclamation-triangle"></i> 
                    <b>L∆ØU √ù QUAN TR·ªåNG:</b> Khi chuy·ªÉn kho·∫£n, b·∫°n nh·ªõ nh·∫≠p ƒë√∫ng <b>M√£ ƒë∆°n h√†ng</b> ·ªü tr√™n v√†o ph·∫ßn "N·ªôi dung/Ghi ch√∫" ƒë·ªÉ ch√∫ng t√¥i x√°c nh·∫≠n!
                </p>
            </div>

            <div id="payment-actions">
                <button id="cancel-order-btn" onclick="closePaymentModal()"><i class="fas fa-times-circle"></i> H·ªßy</button>
                <button id="confirm-order-btn" onclick="submitOrder()"><i class="fas fa-check-circle"></i> OK (X√°c nh·∫≠n ƒë·∫∑t h√†ng)</button>
            </div>
        </div>
    </div>

    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeAdminModal()">&times;</button>
            <div id="admin-login">
                <h3><i class="fas fa-user-lock"></i> ƒêƒÉng Nh·∫≠p Qu·∫£n Tr·ªã</h3>
                <input id="admin-user" placeholder="T√†i kho·∫£n" style="width: calc(100% - 22px); padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc;" /><br>
                <input id="admin-pass" type="password" placeholder="M·∫≠t kh·∫©u" style="width: calc(100% - 22px); padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc;" /><br>
                <button class="main-action-btn" style="background-color: var(--secondary-color);" onclick="adminLogin()"><i class="fas fa-sign-in-alt"></i> ƒêƒÉng Nh·∫≠p</button>
                <div id="admin-error" style="color:red; margin-top:10px;"></div>
            </div>
        </div>
    </div>

        <div id="pre-order-modal" class="pre-order-modal">
        <div class="pre-order-modal-content">
            <button class="modal-close-btn" onclick="closePreOrderModal()">&times;</button>
            <h3><i class="fas fa-calendar-alt"></i> T·∫°o ƒê∆°n H√†ng Tr∆∞·ªõc Cho Kh√°ch</h3>
            <div class="pre-order-card">
                <h4>Ch·ªçn m√≥n ƒÉn</h4>
                <div id="pre-order-product-list"></div>
            </div>
            <div class="pre-order-card">
                <div class="pre-order-header">
                    <h4><i class="fas fa-shopping-basket"></i> Gi·ªè h√†ng ƒë·∫∑t tr∆∞·ªõc</h4>
                    <button id="submit-pre-order-btn" style="display:none;"><i class="fas fa-plus-circle"></i> T·∫°o ƒê∆°n</button>
                </div>
                <div id="pre-order-cart-items">Gi·ªè h√†ng tr·ªëng.</div>
                <div class="pre-order-footer">
                    <div id="pre-order-total" style="font-weight: bold; font-size: 1.2em;">T·ªïng ti·ªÅn: 0 VNƒê</div>
                </div>
            </div>

                <!-- Admin Notifications Modal -->
                <div id="admin-notifications-modal" class="modal">
                    <div class="modal-content">
                        <button class="modal-close-btn" onclick="closeNotifications()">&times;</button>
                        <h3><i class="fas fa-bell"></i> Th√¥ng b√°o ƒë∆°n h√†ng m·ªõi</h3>
                        <div style="display:flex; gap:8px; margin:10px 0; align-items:center;">
                            <input id="notif-search-input" placeholder="T√¨m theo m√£ ƒë∆°n..." style="flex:1; padding:8px;" />
                            <button onclick="renderNotifications(document.getElementById('notif-search-input').value.trim())" class="toggle-detail-btn">T√¨m</button>
                            <button onclick="document.getElementById('notif-search-input').value=''; renderNotifications();" class="toggle-detail-btn">X√≥a</button>
                        </div>
                        <div id="notif-list" style="max-height:50vh; overflow-y:auto; text-align:left;"></div>
                        <div style="display:flex; justify-content:flex-end; margin-top:12px; gap:8px;">
                            <button onclick="closeNotifications()" class="toggle-detail-btn">Quay l·∫°i</button>
                        </div>
                    </div>
                </div>
        </div>
    </div>

    <!-- Admin Order Detail Modal -->
    <div id="admin-stats-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeAdminStats()">&times;</button>
            <h3><i class="fas fa-chart-pie"></i> Th·ªëng k√™ m√≥n</h3>
            <div style="text-align:left; margin-top:12px;">
                <p><b>T·ªïng ƒë∆°n:</b> <span id="stat-total-orders">0</span></p>
                <p><b>S·ªë ƒë∆°n ƒë√£ x√°c nh·∫≠n:</b> <span id="stat-confirmed-orders">0</span></p>
                <p><b>T·ªïng s·ªë m√≥n ƒë√£ ƒë·∫∑t:</b> <span id="stat-food-items">0</span></p>
                <h4 style="margin-top:12px;">Chi ti·∫øt theo m√≥n:</h4>
                <div id="stat-items-list" style="max-height:40vh; overflow:auto; padding:8px; border-radius:8px; background:#f7f9fb;">
                    <!-- danh s√°ch m√≥n s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y: T√™n ‚Äî T·ªïng (ƒê√£ x√°c nh·∫≠n) -->
                </div>
            </div>
            <div style="display:flex; justify-content:flex-end; margin-top:16px;"><button class="main-action-btn" onclick="closeAdminStats()">ƒê√≥ng</button></div>
        </div>
    </div>

    <div id="admin-order-detail-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeAdminOrderDetail()">&times;</button>
            <div id="admin-order-detail-body"></div>
            <div id="admin-order-detail-actions" style="display: flex; gap: 10px; margin-top: 20px; justify-content: flex-end;"></div>
        </div>
    </div>

    <div id="admin-page" class="admin-page">
        <div class="admin-page-content">
            <button id="pre-order-btn" class="main-action-btn" style="background-color: var(--secondary-color); margin-bottom: 20px;" onclick="openPreOrderModalFromAdmin()">
                <i class="fas fa-concierge-bell"></i> ƒê·∫∑t H√†ng Tr∆∞·ªõc
            </button>
            <div class="admin-header">
                <h2><i class="fas fa-cogs"></i> Trang Qu·∫£n Tr·ªã ƒê∆°n H√†ng</h2>
                <div class="admin-header-actions">
                    <button id="notif-btn" onclick="openNotifications()" style="position:relative; margin-right:8px;">
                        <i class="fas fa-bell"></i>
                        <span id="notif-badge" style="position:absolute; top:-6px; right:-6px; background:#e74c3c; color:#fff; font-size:0.75rem; padding:3px 6px; border-radius:999px; display:none;">0</span>
                    </button>
                    <button id="admin-stats-btn-admin" title="Th·ªëng k√™ m√≥n ƒë√£ ƒë·∫∑t" style="padding:8px 12px; border-radius:8px; border:none; background:#fff; color:var(--primary-color); font-weight:700; display:flex; align-items:center; gap:8px;">
                        <i class="fas fa-utensils"></i> Th·ªëng k√™ M√≥n
                    </button>
                    <button id="clear-completed-orders-btn" onclick="clearCompletedOrders()">
                        <i class="fas fa-broom"></i> X√≥a ƒê∆°n Ho√†n Th√†nh
                    </button>
                    <button onclick="logoutAdmin()" class="btn-xoa-don"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
            
            <div id="admin-search-box">
                <input type="text" id="admin-search-input" placeholder="Nh·∫≠p m√£ ƒë∆°n h√†ng..." />
                <button id="admin-search-btn" onclick="searchOrders()"><i class="fas fa-search"></i> T√¨m ki·∫øm</button>
                <button id="admin-search-clear-btn" onclick="clearSearch()"><i class="fas fa-times"></i> Tho√°t t√¨m ki·∫øm</button>
            </div>

            <div id="admin-dashboard">
                <div class="dashboard-item total">
                    <h4>T·ªïng ƒê∆°n H√†ng</h4>
                    <p id="total-orders">0</p>
                </div>
                <div class="dashboard-item paid">
                    <h4>Ch·ªù L·∫•y H√†ng</h4>
                    <p id="paid-orders">0</p>
                </div>
                <div class="dashboard-item pending">
                    <h4>Ch·ªù X√°c Nh·∫≠n</h4>
                    <p id="pending-orders">0</p>
                </div>
                <div class="dashboard-item bank">
                    <h4>Ch·ªù Bank</h4>
                    <p id="bank-orders">0</p>
                </div>
                <div class="dashboard-item completed">
                    <h4>ƒê√£ Ho√†n Th√†nh</h4>
                    <p id="completed-orders">0</p>
                </div>
            </div>
            
            <div id="admin-filter-buttons">
                <button class="filter-btn active" data-filter="all" onclick="filterOrders('all', this)">T·∫•t c·∫£</button>
                <button class="filter-btn" data-filter="paid" onclick="filterOrders('paid', this)">Ch·ªù l·∫•y h√†ng</button>
                <button class="filter-btn" data-filter="pending" onclick="filterOrders('pending', this)">Ch·ªù x√°c nh·∫≠n</button>
                <button class="filter-btn" data-filter="bank-pending" onclick="filterOrders('bank-pending', this)">Ch·ªù Bank</button>
                <button class="filter-btn" data-filter="completed" onclick="filterOrders('completed', this)">ƒê√£ ho√†n th√†nh</button>
            </div>
            <div id="orders-list-admin-filtered"></div>
        </div>
    </div>
    
    <script>
        function setupViewport() {
            let viewportMeta = document.querySelector('meta[name="viewport"]');
            if (!viewportMeta) {
                viewportMeta = document.createElement('meta');
                viewportMeta.setAttribute('name', 'viewport');
                document.head.appendChild(viewportMeta);
            }
            viewportMeta.setAttribute('content', "width=device-width, initial-scale=1.0");
        }
        setupViewport();

        function autoDetectDevice() {
            const screenWidth = window.innerWidth;
            if (screenWidth <= 768) {
                applyDeviceMode('mobile');
            } else {
                applyDeviceMode('desktop');
            }
        }

        function applyDeviceMode(device) {
            if (device === 'mobile') {
                document.body.classList.add('mobile-mode');
                document.documentElement.style.fontSize = '16px';
            } else {
                document.body.classList.remove('mobile-mode');
            }
        }

        window.addEventListener('load', () => {
            autoDetectDevice();
        });

        window.addEventListener('resize', () => {
            autoDetectDevice();
        });

        const JSONBIN_API_KEY = '$2a$10$Ty8HvRqKPOpJsXQRP.cLxeAARlfxR9z2.XRrPnzWKzLtCsoqutZba';
        const JSONBIN_BIN_ID = '68ac4d92ae596e708fd50e99';

        const products = [
    { id: 1, name: "Ph·ªü B√≤ üç≤", price: 40000, image: "https://images.unsplash.com/photo-1551218808-94e220e084d2?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80", category: "main" },
    { id: 2, name: "B√°nh M√¨ Th·ªãt ü•ñ", price: 20000, image: "https://images.unsplash.com/photo-1550547660-d9450f859349?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80", category: "snack" },
    { id: 3, name: "C∆°m T·∫•m üçö", price: 35000, image: "https://www.bing.com/th/id/OIP.Mtuu8M1PCIaR-b0babedqgHaE8?w=287&h=211&c=8&rs=1&qlt=90&o=6&dpr=1.4&pid=3.1&rm=2", category: "main" },
    { id: 4, name: "B√∫n Ch·∫£ üçú", price: 45000, image: "https://images.unsplash.com/photo-1544025162-d76694265947?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80", category: "main" },
    { id: 5, name: "G·ªèi Cu·ªën ü•ó", price: 25000, image: "https://th.bing.com/th/id/OSK.e2a447f5d94a7095044720fb0ab2bc1b?w=208&h=156&rs=2&qlt=80&o=6&cdv=1&dpr=1.4&pid=16.1", category: "snack" },
    { id: 6, name: "M√¨ √ù üçù", price: 50000, image: "https://tse4.mm.bing.net/th/id/OIP.YjonSo8LOCZYVW5vk4H0VwHaEx?rs=1&pid=ImgDetMain&o=7&rm=3", category: "main" },
    { id: 7, name: "Ch√® ƒê·∫≠u Xanh üçÆ", price: 15000, image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80", category: "snack" },
    { id: 8, name: "C√† Ph√™ S·ªØa ‚òï", price: 18000, image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80", category: "drink" }
];

        let cart = [];
        let preOrderCart = [];
        let orders = [];
        let adminNotifications = []; // array of order codes shown in notification badge
        let refreshIntervalId;
        let isLoggedIn = false;
        let tempOrderCode = '';
        let selectedPaymentMethod = '';

        function showSpinner() { document.getElementById('loading-spinner').style.display = 'flex'; }
        function hideSpinner() { document.getElementById('loading-spinner').style.display = 'none'; }

        function showToast(message) {
            const toast = document.getElementById('toast-notification');
            toast.innerText = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 2000);
        }

        function pulseCart() {
            const cartBtn = document.querySelector('.sticky-cart-btn');
            cartBtn.classList.add('pulse-animation');
            setTimeout(() => { cartBtn.classList.remove('pulse-animation'); }, 500);
        }

        async function fetchOrders() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': JSONBIN_API_KEY }
                });
                if (!res.ok) throw new Error('Failed to fetch orders');
                const data = await res.json();
                return (data && data.record && Array.isArray(data.record.orders)) ? data.record.orders : [];
            } catch (err) {
                console.error('Error fetching orders:', err);
                return [];
            }
        }

        async function saveOrders(remoteOrders) {
            try {
                showSpinner();
                await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': JSONBIN_API_KEY },
                    body: JSON.stringify({ orders: remoteOrders })
                });
            } catch (err) {
                console.error('Error saving orders:', err);
            } finally {
                hideSpinner();
            }
        }

        function renderProducts(category = 'all') {
            const productList = document.getElementById('product-list');
            const filteredProducts = category === 'all' ? products : products.filter(p => p.category === category);
            
            if (filteredProducts.length === 0) {
                productList.innerHTML = '<p style="text-align: center; color: var(--light-text-color);">Ch∆∞a c√≥ m√≥n ƒÉn trong danh m·ª•c n√†y.</p>';
                return;
            }

            productList.innerHTML = filteredProducts.map(product => `
                <div class="product" data-id="${product.id}">
                    <img src="${product.image}" alt="${product.name}" />
                    <h3>${product.name}</h3>
                    <p>Gi√°: ${product.price.toLocaleString()} VNƒê</p>
                    <button onclick="addToCart(${product.id})"><i class="fas fa-cart-plus"></i> Th√™m v√†o gi·ªè</button>
                </div>
            `).join('');
        }

        window.filterProducts = function(category, btn) {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderProducts(category);
        }

        function renderCart() {
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const orderBtn = document.getElementById('order-btn');
            if (cart.length === 0) {
                cartItems.innerHTML = 'Gi·ªè h√†ng tr·ªëng.';
                cartTotal.innerHTML = 'T·ªïng ti·ªÅn: 0 VNƒê';
                orderBtn.style.display = 'none';
                return;
            }
            orderBtn.style.display = 'block';
            let total = 0;
            cartItems.innerHTML = cart.map((item, idx) => {
                total += item.price * item.quantity;
                return `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}" />
                        <div class="cart-item-info">
                            <h4>${item.name}</h4>
                            <p>${item.price.toLocaleString()} VNƒê</p>
                        </div>
                        <div class="quantity-control">
                            <button onclick="changeQty(${idx}, -1)"><i class="fas fa-minus"></i></button>
                            <span>${item.quantity}</span>
                            <button onclick="changeQty(${idx}, 1)"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                `;
            }).join('');
            cartTotal.innerHTML = `T·ªïng ti·ªÅn: ${total.toLocaleString()} VNƒê`;
        }

        window.changeQty = function(idx, delta) {
            cart[idx].quantity += delta;
            if (cart[idx].quantity <= 0) cart.splice(idx, 1);
            renderCart();
        };

        window.addToCart = function(productId) {
            const prod = products.find(p => p.id === productId);
            const found = cart.find(item => item.id === prod.id);
            if (found) {
                found.quantity += 1;
            } else {
                cart.push({ ...prod, quantity: 1 });
            }
            renderCart();
            showToast(`ƒê√£ th√™m ${prod.name} v√†o gi·ªè h√†ng!`);
            pulseCart();
        };

        function generateOrderCode() {
            return 'DH' + Math.floor(100000 + Math.random() * 900000);
        }

        document.getElementById('order-btn').onclick = function() {
            if (cart.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m ƒë·ªÉ ƒë·∫∑t h√†ng!');
                return;
            }
            tempOrderCode = generateOrderCode();
            openPaymentModal();
        };

        window.submitOrder = async function() {
    if (!selectedPaymentMethod) {
        alert('Vui l√≤ng ch·ªçn m·ªôt ph∆∞∆°ng th·ª©c thanh to√°n!');
        return;
    }
    
    // L·∫•y th√¥ng tin kh√°ch h√†ng t·ª´ form
    const customerName = document.getElementById('customer-name').value.trim();
    const customerID = document.getElementById('customer-id').value.trim();
    const customerPhone = document.getElementById('customer-phone').value.trim();
    const customerNotes = document.getElementById('customer-notes').value.trim();
    
    // Ki·ªÉm tra th√¥ng tin b·∫Øt bu·ªôc
    if (!customerName || !customerID || !customerPhone) {
        alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß: T√™n, M√£ h·ªçc sinh/sinh vi√™n, v√† S·ªë ƒëi·ªán tho·∫°i!');
        return;
    }
    
    showSpinner();
    const currentOrders = await fetchOrders();
    
    let newOrder = {
        code: tempOrderCode,
        items: cart.map(item => ({ name: item.name, price: item.price, quantity: item.quantity })),
        time: new Date().toLocaleString('vi-VN'),
        status: "pending",
        paymentMethod: selectedPaymentMethod,
        type: "customer_order",
        customer: {
            name: customerName,
            id: customerID,
            phone: customerPhone,
            notes: customerNotes || 'Kh√¥ng c√≥ ghi ch√∫'
        }
    };

    if (selectedPaymentMethod === 'bank') {
        newOrder.status = 'bank-pending';
    }

    await saveOrders([...currentOrders, newOrder]);
    // Add to admin notification badge (do not remove order from orders list)
    try { addNotificationForOrder(newOrder.code); } catch(e) { console.warn('notif helper missing', e); }
    alert('ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng c·ªßa b·∫°n: ' + newOrder.code);
    
    // X√≥a form sau khi submit
    cart = [];
    tempOrderCode = '';
    selectedPaymentMethod = '';
    document.getElementById('customer-name').value = '';
    document.getElementById('customer-id').value = '';
    document.getElementById('customer-phone').value = '';
    document.getElementById('customer-notes').value = '';
    
    renderCart();
    closePaymentModal();
    hideSpinner();
};
        document.getElementById('check-order-btn').onclick = async function() {
            const code = document.getElementById('order-check-input').value;
            if (!code) {
                document.getElementById('check-order-result').innerHTML = '<span style="color:red;">Vui l√≤ng nh·∫≠p m√£ ƒë∆°n h√†ng!</span>';
                return;
            }
            showSpinner();
            const allOrders = await fetchOrders();
            const found = allOrders.find(order => order.code === code.trim());
            const resultDiv = document.getElementById('check-order-result');
            if (found) {
                let statusText, statusClass;
                if (found.status === "completed") {
                    statusText = "ƒê√£ ho√†n th√†nh"; statusClass = "status-completed";
                } else if (found.status === "paid") {
                    statusText = "ƒê√£ thanh to√°n (Ch·ªù l·∫•y h√†ng)"; statusClass = "status-paid";
                } else if (found.status === "bank-pending") {
                    statusText = "Ch·ªù x√°c nh·∫≠n chuy·ªÉn kho·∫£n"; statusClass = "status-pending";
                } else {
                    statusText = "Ch·ªù x√°c nh·∫≠n (Thanh to√°n tr·ª±c ti·∫øp)"; statusClass = "status-pending";
                }
                const total = found.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                resultDiv.innerHTML = `
                    <b>Tr·∫°ng th√°i:</b> <span class="${statusClass} status-tag">${statusText}</span><br>
                    <b>M√£ ƒë∆°n h√†ng:</b> ${found.code}<br>
                    <b>Th·ªùi gian:</b> ${found.time || '-'}<br>
                    <b>T·ªïng ti·ªÅn:</b> ${total.toLocaleString()} VNƒê<br>
                    <b>S·∫£n ph·∫©m:</b>
                    <ul>${found.items.map(item => `<li>${item.name} x ${item.quantity} (${item.price.toLocaleString()} VNƒê)</li>`).join('')}</ul>
                `;
            } else {
                resultDiv.innerHTML = '<span style="color:red;">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng!</span>';
            }
            hideSpinner();
        };

        window.adminLogin = async function() {
            const user = document.getElementById('admin-user').value;
            const pass = document.getElementById('admin-pass').value;
            if (user === 'thanh' && pass === '1') {
                isLoggedIn = true;
                const adminModal = document.getElementById('admin-modal');
                adminModal.classList.remove('show'); // ·∫®n modal c≈©
                setTimeout(() => adminModal.style.display = 'none', 300); // ƒê·ª£i animation xong
                
                document.getElementById('admin-page').style.display = 'flex';
                document.getElementById('admin-page').classList.add('show'); // Hi·ªán admin page v·ªõi animation
                
                await showOrdersAdmin('all');
                refreshIntervalId = setInterval(() => showOrdersAdmin(document.querySelector('.filter-btn.active').dataset.filter), 20000);
            } else {
                document.getElementById('admin-error').innerText = 'Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!';
            }
        };

        window.closeAdminModal = () => {
            const adminModal = document.getElementById('admin-modal');
            adminModal.classList.remove('show');
            setTimeout(() => adminModal.style.display = 'none', 300);
        }

        window.logoutAdmin = function() {
            isLoggedIn = false;
            clearInterval(refreshIntervalId);
            const adminPage = document.getElementById('admin-page');
            adminPage.classList.remove('show');
            setTimeout(() => {
                adminPage.style.display = 'none';
                document.querySelector('.overlay').style.display = 'block';
            }, 300);
        };
        
        function renderDashboard(data) {
            document.getElementById('total-orders').innerText = data.length;
            document.getElementById('pending-orders').innerText = data.filter(o => o.status === 'pending').length;
            document.getElementById('paid-orders').innerText = data.filter(o => o.status === 'paid').length;
            document.getElementById('bank-orders').innerText = data.filter(o => o.status === 'bank-pending').length;
            document.getElementById('completed-orders').innerText = data.filter(o => o.status === 'completed').length;
        }

        window.showOrdersAdmin = async function(filterStatus = 'all', ordersToDisplay = null) {
            const ordersList = document.getElementById('orders-list-admin-filtered');
            
            if (ordersToDisplay === null) {
                ordersList.innerHTML = 'ƒêang t·∫£i ƒë∆°n h√†ng...';
                orders = await fetchOrders();
                if (!Array.isArray(orders) || orders.length === 0) {
                    ordersList.innerHTML = '<i>Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o.</i>';
                    renderDashboard([]);
                    return;
                }
                renderDashboard(orders);
                let filteredOrders;
                if (filterStatus === 'all') {
                    filteredOrders = [...orders];
                } else if (filterStatus === 'bank-pending') {
                    filteredOrders = orders.filter(o => o.status === 'bank-pending');
                } else {
                    filteredOrders = orders.filter(o => o.status === filterStatus);
                }
                ordersToDisplay = filteredOrders;
            } else {
                document.getElementById('admin-filter-buttons').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'none';
                document.getElementById('admin-search-clear-btn').style.display = 'block';
            }
            
            ordersToDisplay.sort((a, b) => new Date(b.time) - new Date(a.time));

            if(ordersToDisplay.length === 0) {
                ordersList.innerHTML = '<i>Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o trong m·ª•c n√†y.</i>';
                return;
            }

            ordersList.innerHTML = ordersToDisplay.map(order => {
                const total = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                let statusText, statusClass, actionButtons;
                const originalIndex = orders.findIndex(o => o.code === order.code);
                
                switch (order.status) {
                    case "paid":
                        statusText = "Ch·ªù l·∫•y h√†ng"; statusClass = "status-paid";
                        actionButtons = `<button class="btn-da-lay-hang" onclick="markOrderAsCompleted(${originalIndex})"><i class="fas fa-box-check"></i> Kh√°ch ƒê√£ L·∫•y</button>`;
                        break;
                    case "completed":
                        statusText = "ƒê√£ ho√†n th√†nh"; statusClass = "status-completed";
                        actionButtons = `<button class="btn-xoa-don" onclick="deleteOrderAdmin(${originalIndex})"><i class="fas fa-trash-alt"></i> X√≥a ƒê∆°n</button>`;
                        break;
                    case "bank-pending":
                        statusText = "Ch·ªù Bank"; statusClass = "status-pending";
                        actionButtons = `<button class="btn-da-thanh-toan" onclick="markOrderAsPaid(${originalIndex})"><i class="fas fa-check-circle"></i> ƒê√£ X√°c Nh·∫≠n Bank</button>`;
                        break;
                    default: // pending
                        statusText = "Ch·ªù x√°c nh·∫≠n"; statusClass = "status-pending";
                        actionButtons = `<button class="btn-da-thanh-toan" onclick="markOrderAsPaid(${originalIndex})"><i class="fas fa-check-circle"></i> ƒê√£ X√°c Nh·∫≠n</button>`;
                        break;
                }

                                return `
                    <div class="admin-order-item">
                        <div class="order-info">
                            <h4>M√£ ƒë∆°n h√†ng: ${order.code}</h4>
                            <p><b>Th·ªùi gian:</b> ${order.time || '-'}</p>
                            <p><b>Tr·∫°ng th√°i:</b> <span class="${statusClass} status-tag">${statusText}</span></p>
                            <p><b>Ph∆∞∆°ng th·ª©c:</b> ${order.paymentMethod === 'bank' ? 'Chuy·ªÉn kho·∫£n Ng√¢n h√†ng' : order.paymentMethod === 'qr' ? 'M√£ QR' : 'Tr·ª±c ti·∫øp'}</p>
                            
                            ${order.customer ? `
                            <div style="background: #e3f2fd; padding: 12px; border-radius: 6px; margin: 10px 0; border-left: 4px solid var(--secondary-color);">
                                <b style="color: var(--secondary-color);">üë§ Kh√°ch h√†ng:</b> ${order.customer.name}<br/>
                                <b style="color: var(--secondary-color);">üìö M√£ HS/SV:</b> ${order.customer.id}<br/>
                                <b style="color: var(--secondary-color);">üì± SƒêT:</b> ${order.customer.phone}
                                ${order.customer.notes && order.customer.notes !== 'Kh√¥ng c√≥ ghi ch√∫' ? '<br/><b style="color: var(--secondary-color);">üìù Ghi ch√∫:</b> ' + order.customer.notes : ''}
                            </div>
                            ` : ''}
                            
                            <p><b>T·ªïng ti·ªÅn:</b> ${total.toLocaleString()} VNƒê</p>
                            <p><b>Chi ti·∫øt:</b></p>
                            <ul style="list-style-type: disc; padding-left: 20px; margin-top: 5px;">
                                ${order.items.map(item => `<li>${item.name} x ${item.quantity} (${item.price.toLocaleString()} VNƒê)</li>`).join('')}
                            </ul>
                        </div>
                        <div class="order-actions">${actionButtons}</div>
                    </div>
                `;
            }).join('');
        };
        
        window.searchOrders = async function() {
    const query = document.getElementById('admin-search-input').value.trim().toUpperCase();
    if (!query) {
        alert('Vui l√≤ng nh·∫≠p m√£ ƒë∆°n h√†ng!');
        return;
    }
    
    showSpinner();
    // N·∫øu ch∆∞a load orders, h√£y fetch t·ª´ API
    if (!orders || orders.length === 0) {
        orders = await fetchOrders();
    }
    
    const foundOrder = orders.find(o => o.code && o.code.toUpperCase() === query);
    
    if (foundOrder) {
        showOrdersAdmin('all', [foundOrder]);
        document.getElementById('admin-filter-buttons').style.display = 'none';
        document.getElementById('admin-dashboard').style.display = 'none';
        document.getElementById('admin-search-clear-btn').style.display = 'block';
    } else {
        document.getElementById('orders-list-admin-filtered').innerHTML = '<i>Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o v·ªõi m√£ n√†y.</i>';
        document.getElementById('admin-filter-buttons').style.display = 'none';
        document.getElementById('admin-dashboard').style.display = 'none';
        document.getElementById('admin-search-clear-btn').style.display = 'block';
    }
    hideSpinner();
};

        window.clearSearch = function() {
            document.getElementById('admin-search-input').value = '';
            document.getElementById('admin-filter-buttons').style.display = 'flex';
            document.getElementById('admin-dashboard').style.display = 'grid';
            document.getElementById('admin-search-clear-btn').style.display = 'none';
            showOrdersAdmin(document.querySelector('.filter-btn.active').dataset.filter);
        }

        window.filterOrders = function(status, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            showOrdersAdmin(status);
        };

        async function updateOrderStatus(idx, newStatus) {
            showSpinner();
            orders = await fetchOrders();
            if (orders[idx]) {
                orders[idx].status = newStatus;
                await saveOrders(orders);
            }
            await showOrdersAdmin(document.querySelector('.filter-btn.active').dataset.filter);
            hideSpinner();
        }

        window.markOrderAsPaid = (idx) => updateOrderStatus(idx, 'paid'); // ƒê√£ thanh to√°n (ch·ªù l·∫•y h√†ng)
        window.markOrderAsCompleted = (idx) => updateOrderStatus(idx, 'completed');

        window.deleteOrderAdmin = async function(idx) {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ƒë∆°n h√†ng n√†y?')) return;
            showSpinner();
            orders = await fetchOrders();
            orders.splice(idx, 1);
            await saveOrders(orders);
            await showOrdersAdmin(document.querySelector('.filter-btn.active').dataset.filter);
            hideSpinner();
        };
        
        window.clearCompletedOrders = async function() {
            if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a T·∫§T C·∫¢ c√°c ƒë∆°n h√†ng ƒê√É HO√ÄN TH√ÄNH kh√¥ng?')) return;
            showSpinner();
            let allOrders = await fetchOrders();
            const remainingOrders = allOrders.filter(order => order.status !== 'completed');
            await saveOrders(remainingOrders);
            alert('ƒê√£ x√≥a th√†nh c√¥ng t·∫•t c·∫£ c√°c ƒë∆°n h√†ng ƒë√£ ho√†n th√†nh.');
            await showOrdersAdmin(document.querySelector('.filter-btn.active').dataset.filter);
            hideSpinner();
        };
        
        document.getElementById('admin-btn').onclick = function() {
            if (isLoggedIn) {
                document.querySelector('.overlay').style.display = 'none';
                document.getElementById('admin-page').style.display = 'flex';
                document.getElementById('admin-page').classList.add('show');
                clearSearch();
                showOrdersAdmin('all');
            } else {
                const adminModal = document.getElementById('admin-modal');
                adminModal.style.display = 'flex';
                setTimeout(() => adminModal.classList.add('show'), 10); // Show modal with animation
                document.getElementById('admin-user').value = '';
                document.getElementById('admin-pass').value = '';
                document.getElementById('admin-error').innerText = '';
            }
        };

        window.openPreOrderModalFromAdmin = function() {
            const adminPage = document.getElementById('admin-page');
            adminPage.classList.remove('show');
            setTimeout(() => adminPage.style.display = 'none', 300);

            const preOrderModal = document.getElementById('pre-order-modal');
            preOrderModal.style.display = 'flex';
            setTimeout(() => preOrderModal.classList.add('show'), 10);
            preOrderCart = [];
            renderPreOrderProducts();
            renderPreOrderCart();
        }

        window.closePreOrderModal = function() {
            const preOrderModal = document.getElementById('pre-order-modal');
            preOrderModal.classList.remove('show');
            setTimeout(() => {
                preOrderModal.style.display = 'none';
                if (isLoggedIn) {
                    document.getElementById('admin-page').style.display = 'flex';
                    document.getElementById('admin-page').classList.add('show');
                }
                else document.querySelector('.overlay').style.display = 'block';
            }, 300);
        }

        function renderPreOrderProducts() {
            document.getElementById('pre-order-product-list').innerHTML = products.map(product => `
                <div class="product">
                    <img src="${product.image}" alt="${product.name}" />
                    <h3>${product.name}</h3>
                    <p>Gi√°: ${product.price.toLocaleString()} VNƒê</p>
                    <div style="display:flex; justify-content:center; gap: 5px;">
                        <input type="number" id="pre-order-qty-${product.id}" value="1" min="1" style="width: 50px; text-align: center; border-radius: 5px;" />
                        <button onclick="addToPreOrderCart(${product.id})"><i class="fas fa-cart-plus"></i> Th√™m</button>
                    </div>
                </div>
            `).join('');
        }

        window.addToPreOrderCart = function(productId) {
            const prod = products.find(p => p.id === productId);
            const quantity = parseInt(document.getElementById(`pre-order-qty-${productId}`).value);
            if (isNaN(quantity) || quantity <= 0) return alert('S·ªë l∆∞·ª£ng kh√¥ng h·ª£p l·ªá!');
            
            const found = preOrderCart.find(item => item.id === prod.id);
            if (found) found.quantity += quantity;
            else preOrderCart.push({ ...prod, quantity: quantity });
            renderPreOrderCart();
        }

        function renderPreOrderCart() {
            const cartItems = document.getElementById('pre-order-cart-items');
            const totalDiv = document.getElementById('pre-order-total');
            const submitBtn = document.getElementById('submit-pre-order-btn');
            if (preOrderCart.length === 0) {
                cartItems.innerHTML = 'Gi·ªè h√†ng tr·ªëng.';
                totalDiv.innerHTML = 'T·ªïng ti·ªÅn: 0 VNƒê';
                submitBtn.style.display = 'none';
                return;
            }
            submitBtn.style.display = 'block';
            let total = 0;
            cartItems.innerHTML = preOrderCart.map((item, idx) => {
                total += item.price * item.quantity;
                return `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}" />
                        <div class="cart-item-info"><h4>${item.name}</h4><p>${item.price.toLocaleString()} VNƒê</p></div>
                        <div class="quantity-control">
                            <button onclick="changePreOrderQty(${idx}, -1)"><i class="fas fa-minus"></i></button>
                            <span>${item.quantity}</span>
                            <button onclick="changePreOrderQty(${idx}, 1)"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>`;
            }).join('');
            totalDiv.innerHTML = `T·ªïng ti·ªÅn: ${total.toLocaleString()} VNƒê`;
        }

        window.changePreOrderQty = function(idx, delta) {
            preOrderCart[idx].quantity += delta;
            if (preOrderCart[idx].quantity <= 0) preOrderCart.splice(idx, 1);
            renderPreOrderCart();
        }

        document.getElementById('submit-pre-order-btn').onclick = async function() {
            if (preOrderCart.length === 0) return;
            showSpinner();
            const newPreOrder = {
                code: generateOrderCode(),
                items: preOrderCart.map(item => ({ name: item.name, price: item.price, quantity: item.quantity })),
                time: new Date().toLocaleString('vi-VN'),
                status: "paid", // ƒê∆°n ƒë·∫∑t tr∆∞·ªõc m·∫∑c ƒë·ªãnh l√† ƒë√£ tr·∫£ ti·ªÅn, ch·ªù l·∫•y h√†ng
                type: "preorder"
            };
            const currentOrders = await fetchOrders();
            await saveOrders([...currentOrders, newPreOrder]);
            alert(`ƒê√£ t·∫°o ƒë∆°n h√†ng tr∆∞·ªõc th√†nh c√¥ng! M√£ ƒë∆°n: ${newPreOrder.code}`);
            closePreOrderModal();
            showOrdersAdmin('all');
            hideSpinner();
        };

        window.openCartModal = function() {
            const cartModal = document.getElementById('cart-modal');
            cartModal.style.display = 'flex';
            setTimeout(() => cartModal.classList.add('show'), 10);
            renderCart();
        }
        
        window.closeCartModal = () => {
            const cartModal = document.getElementById('cart-modal');
            cartModal.classList.remove('show');
            setTimeout(() => cartModal.style.display = 'none', 300);
        }

        window.openPaymentModal = function() {
            document.getElementById('payment-order-code').innerText = tempOrderCode;
            closeCartModal();
            const paymentModal = document.getElementById('payment-modal');
            paymentModal.style.display = 'flex';
            setTimeout(() => paymentModal.classList.add('show'), 10);
            document.getElementById('qr-code-container').style.display = 'none';
            document.getElementById('bank-info-container').style.display = 'none';
            document.querySelectorAll('#payment-methods button').forEach(btn => btn.classList.remove('active'));
            selectedPaymentMethod = '';
        }

        window.closePaymentModal = function() {
            const paymentModal = document.getElementById('payment-modal');
            paymentModal.classList.remove('show');
            setTimeout(() => {
                paymentModal.style.display = 'none';
                if(tempOrderCode) openCartModal();
                tempOrderCode = '';
            }, 300);
        }
        
        // --- Device Selection Handler ---
        window.selectDevice = function(deviceType) {
            const modal = document.getElementById('device-selection-modal');
            modal.classList.remove('show');
            
            if (deviceType === 'mobile') {
                document.body.classList.add('mobile-mode');
                localStorage.setItem('deviceMode', 'mobile');
            } else {
                document.body.classList.remove('mobile-mode');
                localStorage.setItem('deviceMode', 'desktop');
            }
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.querySelector('.overlay').style.display = 'block';
            }, 300);
        };

        // Initialize device selection on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedMode = localStorage.getItem('deviceMode');
            const deviceModal = document.getElementById('device-selection-modal');
            
            if (!savedMode && deviceModal) {
                // No saved preference, show the modal
                setTimeout(() => {
                    deviceModal.classList.add('show');
                }, 300);
            } else if (savedMode === 'mobile') {
                document.body.classList.add('mobile-mode');
                if (deviceModal) deviceModal.style.display = 'none';
            } else {
                if (deviceModal) deviceModal.style.display = 'none';
            }
        });

        // --- End Device Selection ---
        
        // --- Notifications helpers ---
        let lastOpenedNotificationCode = null;
        function addNotificationForOrder(code) {
            if (!code) return;
            if (!adminNotifications.includes(code)) adminNotifications.push(code);
            updateNotifBadge();
        }
        function updateNotifBadge() {
            const badge = document.getElementById('notif-badge');
            if (!badge) return;
            if (adminNotifications.length === 0) { badge.style.display = 'none'; badge.innerText = '0'; }
            else { badge.style.display = 'inline-block'; badge.innerText = adminNotifications.length; }
        }

        window.openNotifications = function() {
            console.log('openNotifications called');
            renderNotifications();
            const modal = document.getElementById('admin-notifications-modal');
            if (!modal) { console.error('admin-notifications-modal not found'); return; }
            // Ensure modal is at body level (avoid being behind transformed parents)
            if (modal.parentElement !== document.body) document.body.appendChild(modal);
            // Force high z-index so it floats above everything while open
            modal.style.zIndex = 99999;
            const content = modal.querySelector('.modal-content');
            if (content) content.style.background = '#fff';
            modal.style.display = 'flex';
            setTimeout(() => { modal.classList.add('show'); const s = document.getElementById('notif-search-input'); if (s) s.focus(); }, 10);
        }
        window.closeNotifications = function() {
            const modal = document.getElementById('admin-notifications-modal');
            modal.classList.remove('show');
            setTimeout(() => { modal.style.display = 'none'; }, 300);
        }

        async function renderNotifications(filter = '') {
            const list = document.getElementById('notif-list');
            if (!list) return;
            orders = await fetchOrders();
            const items = adminNotifications.map(code => {
                const idx = orders.findIndex(o => o.code === code);
                const order = orders[idx] || { code };
                return { code, idx, name: order.customer ? order.customer.name : 'Kh√°ch ·∫©n' };
            }).filter(it => !filter || it.code.toUpperCase().includes(filter.toUpperCase()));

            if (items.length === 0) { list.innerHTML = '<i>Kh√¥ng c√≥ th√¥ng b√°o m·ªõi.</i>'; return; }
            list.innerHTML = items.map((it, index) => `
                <div style="padding:10px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <div style="font-weight:700;">${it.name}</div>
                        <div style="color:#666; font-size:0.95rem;">M√£: ${it.code}</div>
                    </div>
                    <div style="display:flex; gap:8px;">
                        <button class="toggle-detail-btn" data-order-code="${it.code}">Chi ti·∫øt</button>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to detail buttons
            list.querySelectorAll('button.toggle-detail-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const code = this.getAttribute('data-order-code');
                    showAdminOrderDetailFromNotif(code);
                });
            });
        }

        window.showAdminOrderDetailFromNotif = async function(code) {
            orders = await fetchOrders();
            const idx = orders.findIndex(o => o.code === code);
            if (idx === -1) { alert('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng.'); return; }
            lastOpenedNotificationCode = code;
            showAdminOrderDetail(idx);
        }

        // Show order detail modal (used by both inline and notification flows)
        window.showAdminOrderDetail = async function(idx) {
            try {
                if (refreshIntervalId) { clearInterval(refreshIntervalId); refreshIntervalId = null; }
                showSpinner();
                orders = await fetchOrders();
                const order = orders[idx];
                if (!order) { alert('Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng.'); hideSpinner(); return; }

                const body = document.getElementById('admin-order-detail-body');
                const actions = document.getElementById('admin-order-detail-actions');
                const total = order.items.reduce((s,i) => s + (i.price * i.quantity), 0);
                body.innerHTML = `
                    <h3>M√£ ƒë∆°n h√†ng: ${order.code}</h3>
                    <p><b>Kh√°ch:</b> ${order.customer ? order.customer.name : '-'} ‚Äî ${order.customer ? order.customer.phone : '-'}</p>
                    <p><b>Ghi ch√∫:</b> ${order.customer && order.customer.notes ? order.customer.notes : 'Kh√¥ng c√≥ ghi ch√∫'}</p>
                    <p><b>Th·ªùi gian:</b> ${order.time || '-'}</p>
                    <h4>Items (${order.items.length}) ‚Äî T·ªïng: ${total.toLocaleString()} VNƒê</h4>
                    <ul style="padding-left:18px;">${order.items.map(it => `<li>${it.name} x ${it.quantity} ‚Äî ${it.price.toLocaleString()} VNƒê</li>`).join('')}</ul>
                `;
                actions.innerHTML = '';
                if (order.status !== 'paid') actions.innerHTML += `<button class="btn-da-thanh-toan" onclick="removeFromNotificationAndAction(${idx}, 'markOrderAsPaid');">X√°c nh·∫≠n</button>`;
                if (order.status === 'paid') actions.innerHTML += `<button class="btn-da-lay-hang" onclick="removeFromNotificationAndAction(${idx}, 'markOrderAsCompleted');">ƒê√°nh d·∫•u ƒë√£ l·∫•y</button>`;
                if (order.status === 'completed') actions.innerHTML += `<button class="btn-xoa-don" onclick="removeFromNotificationAndAction(${idx}, 'deleteOrderAdmin');">X√≥a</button>`;
                actions.innerHTML += `<button onclick="closeAdminOrderDetail()" style="background:#6c757d;padding:8px 12px;border-radius:6px;color:#fff;border:none;">ƒê√≥ng</button>`;

                const modal = document.getElementById('admin-order-detail-modal');
                if (modal.parentElement !== document.body) document.body.appendChild(modal);
                modal.style.zIndex = 99999;
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
                hideSpinner();
            } catch (e) { console.error(e); hideSpinner(); alert('L·ªói khi m·ªü chi ti·∫øt.'); }
        }

        // Function to remove from notification and execute action
        window.removeFromNotificationAndAction = async function(idx, actionName) {
            // Remove from notification list if opened from notification
            if (lastOpenedNotificationCode) {
                const i = adminNotifications.indexOf(lastOpenedNotificationCode);
                if (i !== -1) adminNotifications.splice(i,1);
                lastOpenedNotificationCode = null;
                updateNotifBadge();
                const notifModal = document.getElementById('admin-notifications-modal');
                if (notifModal && notifModal.style.display === 'flex') renderNotifications();
            }
            // Execute the action
            if (actionName === 'markOrderAsPaid') {
                await markOrderAsPaid(idx);
            } else if (actionName === 'markOrderAsCompleted') {
                await markOrderAsCompleted(idx);
            } else if (actionName === 'deleteOrderAdmin') {
                await deleteOrderAdmin(idx);
            }
            closeAdminOrderDetail();
        };

        // Override/ensure close behavior: just close modal without removing from notifications
        window.closeAdminOrderDetail = function() {
            const modal = document.getElementById('admin-order-detail-modal');
            if (modal) modal.classList.remove('show');
            setTimeout(() => { if (modal) modal.style.display = 'none'; }, 300);
            lastOpenedNotificationCode = null;
            // resume periodic refresh if needed
            if (!refreshIntervalId) {
                try { refreshIntervalId = setInterval(() => showOrdersAdmin(document.querySelector('.filter-btn.active').dataset.filter), 20000); } catch(e) {}
            }
        }

        // Ensure badge updated on load
        // --- Quick admin stats: compute and render counts ---
        function computeAdminStats() {
            const all = Array.isArray(orders) ? orders : [];
            const totalOrders = all.length;
            const confirmedStatuses = ['paid','completed'];
            const confirmedOrders = all.filter(o => confirmedStatuses.includes((o.status||'').toLowerCase())).length;

            // Aggregate per-item totals and confirmed totals
            const itemMap = {}; // name -> { total: n, confirmed: m }
            let totalFoodItems = 0;
            all.forEach(o => {
                const isConfirmed = confirmedStatuses.includes((o.status||'').toLowerCase());
                if (!Array.isArray(o.items)) return;
                o.items.forEach(it => {
                    const name = it.name || 'Kh√¥ng r√µ';
                    const qty = parseInt(it.quantity) || 1;
                    if (!itemMap[name]) itemMap[name] = { total: 0, confirmed: 0 };
                    itemMap[name].total += qty;
                    if (isConfirmed) itemMap[name].confirmed += qty;
                    totalFoodItems += qty;
                });
            });

            // Render summary numbers
            const elTotal = document.getElementById('stat-total-orders');
            const elFood = document.getElementById('stat-food-items');
            const elConfirmed = document.getElementById('stat-confirmed-orders');
            if (elTotal) elTotal.innerText = totalOrders;
            if (elFood) elFood.innerText = totalFoodItems;
            if (elConfirmed) elConfirmed.innerText = confirmedOrders;

            // Render per-item breakdown
            const itemsList = document.getElementById('stat-items-list');
            if (itemsList) {
                const rows = Object.keys(itemMap).sort().map(name => {
                    const it = itemMap[name];
                    return `<div style="display:flex; justify-content:space-between; padding:6px 8px; border-bottom:1px dashed #eee;"><div style="font-weight:600;">${name}</div><div style="color:var(--secondary-color);">${it.total} <span style="color:#666; font-weight:600; font-size:0.9rem;">(ƒê√£ x√°c nh·∫≠n: ${it.confirmed})</span></div></div>`;
                }).join('');
                itemsList.innerHTML = rows || '<i>Ch∆∞a c√≥ m√≥n n√†o ƒë∆∞·ª£c ƒë·∫∑t.</i>';
            }

            // update main admin dashboard counters if present
            const t = document.getElementById('total-orders'); if (t) t.innerText = totalOrders;
            const p = document.getElementById('pending-orders'); if (p) p.innerText = all.filter(o => o.status === 'pending').length;
            const paid = document.getElementById('paid-orders'); if (paid) paid.innerText = all.filter(o => o.status === 'paid').length;
            const bank = document.getElementById('bank-orders'); if (bank) bank.innerText = all.filter(o => o.status === 'bank-pending').length;
            const comp = document.getElementById('completed-orders'); if (comp) comp.innerText = all.filter(o => o.status === 'completed').length;
        }

        function openAdminStats() {
            // ensure latest orders fetched before computing
            fetchOrders().then(fetched => {
                orders = Array.isArray(fetched) ? fetched : orders;
                computeAdminStats();
                const modal = document.getElementById('admin-stats-modal');
                if (modal) {
                    // move to body to avoid stacking-context issues and force on-top
                    if (modal.parentElement !== document.body) document.body.appendChild(modal);
                    modal.style.position = 'fixed';
                    modal.style.zIndex = '999999';
                    modal.style.display = 'flex';
                    // ensure modal-content sits above overlay
                    const content = modal.querySelector('.modal-content');
                    if (content) content.style.zIndex = '1000000';
                    setTimeout(() => modal.classList.add('show'), 10);
                } else {
                    alert('S·ªë m√≥n ƒë√£ ƒë·∫∑t: ' + document.getElementById('stat-food-items').innerText + '\nƒê∆°n ƒë√£ x√°c nh·∫≠n: ' + document.getElementById('stat-confirmed-orders').innerText);
                }
            }).catch(err => { console.error(err); computeAdminStats(); const m = document.getElementById('admin-stats-modal'); if (m) { m.style.display='flex'; setTimeout(()=>m.classList.add('show'),10);} });
        }

        function closeAdminStats() {
            const modal = document.getElementById('admin-stats-modal');
            if (!modal) return;
            modal.classList.remove('show');
            setTimeout(() => { modal.style.display = 'none'; }, 300);
        }

        // bind header and admin-page buttons
        try { document.getElementById('admin-stats-btn').addEventListener('click', openAdminStats); } catch(e) {}
        try { document.getElementById('admin-stats-btn-admin').addEventListener('click', openAdminStats); } catch(e) {}

        // refresh stats periodically while page active
        setInterval(() => { try { computeAdminStats(); } catch(e){} }, 5000);
        updateNotifBadge();
        renderProducts('all');
    </script>
</body>
</html>